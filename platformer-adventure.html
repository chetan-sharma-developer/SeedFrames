<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Platformer Adventure - SeedFrames Engine</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
        }
        
        .game-container {
            border: 3px solid #4a90e2;
            border-radius: 10px;
            margin: 20px auto;
            display: inline-block;
            box-shadow: 0 0 20px rgba(74, 144, 226, 0.5);
        }
        
        .game-info {
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 8px;
            margin: 20px auto;
            max-width: 800px;
        }
        
        .controls {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            margin: 10px 0;
        }
        
        .stat {
            background: rgba(74, 144, 226, 0.3);
            padding: 10px;
            border-radius: 5px;
            min-width: 100px;
        }
        
        h1 {
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            margin-bottom: 20px;
        }
        
        .level-indicator {
            background: rgba(255, 215, 0, 0.3);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            border: 2px solid gold;
        }
    </style>
</head>
<body>
    <h1>üèÉ‚Äç‚ôÇÔ∏è Platformer Adventure</h1>
    
    <div class="game-info">
        <div class="level-indicator">
            <strong>Level: <span id="current-level">1</span></strong>
        </div>
        
        <div class="stats">
            <div class="stat">
                <strong>Score:</strong><br>
                <span id="score">0</span>
            </div>
            <div class="stat">
                <strong>Lives:</strong><br>
                <span id="lives">3</span>
            </div>
            <div class="stat">
                <strong>Coins:</strong><br>
                <span id="coins">0</span>
            </div>
            <div class="stat">
                <strong>Enemies Defeated:</strong><br>
                <span id="enemies-defeated">0</span>
            </div>
        </div>
        
        <div class="controls">
            <strong>Controls:</strong><br>
            <strong>WASD</strong> or <strong>Arrow Keys</strong> to move<br>
            <strong>Space</strong> to jump<br>
            <strong>E</strong> to attack<br>
            <strong>R</strong> to restart level
        </div>
    </div>
    
    <div class="game-container" id="game-container"></div>
    
    <script src="./src/seedframes.js"></script>
    <script>
        let engine, scene, player;
        let gameState = {
            score: 0,
            lives: 3,
            coins: 0,
            enemiesDefeated: 0,
            currentLevel: 1,
            levelCompleted: false
        };
        
        let enemies = [];
        let coins = [];
        let platforms = [];
        let levelData = [];
        
        // Level designs
        const levels = [
            // Level 1 - Tutorial
            {
                platforms: [
                    {x: 100, y: 500, width: 200, height: 20},
                    {x: 400, y: 400, width: 150, height: 20},
                    {x: 650, y: 300, width: 200, height: 20},
                    {x: 900, y: 200, width: 150, height: 20}
                ],
                enemies: [
                    {x: 450, y: 350, type: 'patrol', patrolDistance: 100}
                ],
                coins: [
                    {x: 450, y: 350}, {x: 700, y: 250}, {x: 950, y: 150}
                ],
                goal: {x: 950, y: 150}
            },
            // Level 2 - More challenging
            {
                platforms: [
                    {x: 50, y: 550, width: 150, height: 20},
                    {x: 300, y: 450, width: 120, height: 20},
                    {x: 550, y: 350, width: 100, height: 20},
                    {x: 750, y: 250, width: 120, height: 20},
                    {x: 950, y: 150, width: 150, height: 20}
                ],
                enemies: [
                    {x: 350, y: 400, type: 'patrol', patrolDistance: 80},
                    {x: 800, y: 200, type: 'patrol', patrolDistance: 60}
                ],
                coins: [
                    {x: 350, y: 400}, {x: 600, y: 300}, {x: 800, y: 200}, {x: 1000, y: 100}
                ],
                goal: {x: 1000, y: 100}
            }
        ];
        
        function initGame() {
            try {
                engine = new GameEngine.SeedFrames({
                    width: 1200,
                    height: 600,
                    containerId: 'game-container',
                    backgroundColor: '#87CEEB',
                    debug: false
                });
                
                scene = engine.createScene('PlatformerLevel');
                engine.sceneManager.add('main', scene);
                engine.sceneManager.load('main');
                
                // Setup physics
                engine.physicsEngine.setCollisionRule('Player', 'Platform', true);
                engine.physicsEngine.setCollisionRule('Player', 'Enemy', true);
                engine.physicsEngine.setCollisionRule('Player', 'Coin', true);
                engine.physicsEngine.setCollisionRule('Player', 'Goal', true);
                engine.physicsEngine.setCollisionRule('PlayerBullet', 'Enemy', true);
                
                // Setup camera
                scene.camera.follow(player);
                
                loadLevel(gameState.currentLevel);
                
                engine.start();
                console.log('Platformer Adventure started!');
                
            } catch (error) {
                console.error('Failed to initialize game:', error);
            }
        }
        
        function loadLevel(levelIndex) {
            if (levelIndex > levels.length) {
                // Game completed!
                showGameComplete();
                return;
            }
            
            // Clear previous level
            clearLevel();
            
            const level = levels[levelIndex - 1];
            gameState.currentLevel = levelIndex;
            gameState.levelCompleted = false;
            
            // Create player
            player = scene.createGameObject('Player')
                .at(100, 400)
                .withColor('#4a90e2', 32, 48)
                .withCollider('box', 32, 48, false, 'Player')
                .withPlatformerPlayer({
                    speed: 200,
                    jumpForce: 450,
                    onJump: () => console.log('Player jumped!')
                })
                .build();
            
            // Add player components
            const playerComponent = player.getComponent(GameEngine.PlatformerPlayer);
            playerComponent.onDeath = () => playerDeath();
            
            // Create platforms
            level.platforms.forEach((platformData, index) => {
                const platform = scene.createGameObject(`Platform${index}`)
                    .at(platformData.x, platformData.y)
                    .withColor('#8B4513', platformData.width, platformData.height)
                    .withCollider('box', platformData.width, platformData.height, false, 'Platform')
                    .build();
                platforms.push(platform);
            });
            
            // Create enemies
            level.enemies.forEach((enemyData, index) => {
                const enemy = createEnemy(enemyData, index);
                enemies.push(enemy);
            });
            
            // Create coins
            level.coins.forEach((coinData, index) => {
                const coin = scene.createGameObject(`Coin${index}`)
                    .at(coinData.x, coinData.y)
                    .withColor('#FFD700', 16, 16)
                    .withCollider('box', 16, 16, true, 'Coin')
                    .build();
                
                // Add coin behavior
                const coinComponent = coin.addComponent(new CoinComponent());
                coins.push(coin);
            });
            
            // Create goal
            const goal = scene.createGameObject('Goal')
                .at(level.goal.x, level.goal.y)
                .withColor('#00FF00', 32, 32)
                .withCollider('box', 32, 32, true, 'Goal')
                .build();
            
            // Setup camera
            scene.camera.follow(player);
            
            updateUI();
        }
        
        function createEnemy(enemyData, index) {
            const enemy = scene.createGameObject(`Enemy${index}`)
                .at(enemyData.x, enemyData.y)
                .withColor('#FF4444', 32, 32)
                .withCollider('box', 32, 32, false, 'Enemy')
                .build();
            
            // Add enemy AI component
            const enemyAI = enemy.addComponent(new EnemyAIComponent(enemyData));
            
            return enemy;
        }
        
        function clearLevel() {
            // Remove all game objects except the scene
            if (scene) {
                const objectsToRemove = [...scene.gameObjects];
                objectsToRemove.forEach(obj => {
                    if (obj.name !== 'Scene') {
                        scene.removeGameObject(obj);
                    }
                });
            }
            
            enemies = [];
            coins = [];
            platforms = [];
        }
        
        function playerDeath() {
            gameState.lives--;
            updateUI();
            
            if (gameState.lives <= 0) {
                gameOver();
            } else {
                // Respawn player
                setTimeout(() => {
                    loadLevel(gameState.currentLevel);
                }, 1000);
            }
        }
        
        function collectCoin(coin) {
            gameState.coins++;
            gameState.score += 100;
            scene.removeGameObject(coin);
            coins = coins.filter(c => c !== coin);
            updateUI();
        }
        
        function defeatEnemy(enemy) {
            gameState.enemiesDefeated++;
            gameState.score += 200;
            scene.removeGameObject(enemy);
            enemies = enemies.filter(e => e !== enemy);
            updateUI();
        }
        
        function reachGoal() {
            if (gameState.levelCompleted) return;
            
            gameState.levelCompleted = true;
            gameState.score += 500;
            updateUI();
            
            // Show level complete message
            setTimeout(() => {
                if (confirm(`Level ${gameState.currentLevel} completed! Score: ${gameState.score}\nContinue to next level?`)) {
                    loadLevel(gameState.currentLevel + 1);
                }
            }, 500);
        }
        
        function gameOver() {
            alert(`Game Over! Final Score: ${gameState.score}`);
            // Reset game
            gameState = {
                score: 0,
                lives: 3,
                coins: 0,
                enemiesDefeated: 0,
                currentLevel: 1,
                levelCompleted: false
            };
            loadLevel(1);
        }
        
        function showGameComplete() {
            alert(`Congratulations! You've completed all levels!\nFinal Score: ${gameState.score}`);
            // Reset to level 1
            gameState.currentLevel = 1;
            loadLevel(1);
        }
        
        function updateUI() {
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('lives').textContent = gameState.lives;
            document.getElementById('coins').textContent = gameState.coins;
            document.getElementById('enemies-defeated').textContent = gameState.enemiesDefeated;
            document.getElementById('current-level').textContent = gameState.currentLevel;
        }
        
        // Custom Components
        class CoinComponent extends GameEngine.Component {
            constructor() {
                super();
                this.collected = false;
            }
            
            update(deltaTime) {
                // Rotate coin
                if (this.gameObject) {
                    this.gameObject.transform.rotation += deltaTime * 2;
                }
            }
            
            onCollisionEnter(other) {
                if (other.name === 'Player' && !this.collected) {
                    this.collected = true;
                    collectCoin(this.gameObject);
                }
            }
        }
        
        class EnemyAIComponent extends GameEngine.Component {
            constructor(enemyData) {
                super();
                this.startX = enemyData.x;
                this.patrolDistance = enemyData.patrolDistance || 100;
                this.direction = 1;
                this.speed = 50;
                this.health = 2;
            }
            
            update(deltaTime) {
                if (!this.gameObject) return;
                
                // Simple patrol behavior
                const currentX = this.gameObject.transform.position.x;
                const targetX = this.startX + (this.direction * this.patrolDistance);
                
                if (Math.abs(currentX - targetX) < 10) {
                    this.direction *= -1;
                }
                
                this.gameObject.transform.position.x += this.direction * this.speed * deltaTime;
            }
            
            onCollisionEnter(other) {
                if (other.name === 'Player') {
                    // Damage player
                    const playerComponent = other.getComponent(GameEngine.PlatformerPlayer);
                    if (playerComponent) {
                        playerComponent.takeDamage(1);
                    }
                }
            }
            
            takeDamage(amount) {
                this.health -= amount;
                if (this.health <= 0) {
                    defeatEnemy(this.gameObject);
                }
            }
        }
        
        // Input handling
        document.addEventListener('keydown', (e) => {
            if (!player) return;
            
            switch(e.code) {
                case 'KeyR':
                    loadLevel(gameState.currentLevel);
                    break;
                case 'KeyE':
                    // Attack
                    attack();
                    break;
            }
        });
        
        function attack() {
            if (!player) return;
            
            // Create attack projectile
            const bullet = scene.createGameObject('PlayerBullet')
                .at(player.transform.position.x, player.transform.position.y)
                .withColor('#FFFF00', 8, 8)
                .withCollider('box', 8, 8, false, 'PlayerBullet')
                .build();
            
            // Add bullet behavior
            bullet.addComponent(new BulletComponent());
        }
        
        class BulletComponent extends GameEngine.Component {
            constructor() {
                super();
                this.speed = 300;
                this.lifetime = 2.0;
                this.timer = 0;
            }
            
            update(deltaTime) {
                if (!this.gameObject) return;
                
                // Move bullet
                this.gameObject.transform.position.x += this.speed * deltaTime;
                
                // Check lifetime
                this.timer += deltaTime;
                if (this.timer >= this.lifetime) {
                    scene.removeGameObject(this.gameObject);
                }
            }
            
            onCollisionEnter(other) {
                if (other.name.includes('Enemy')) {
                    const enemyAI = other.getComponent(EnemyAIComponent);
                    if (enemyAI) {
                        enemyAI.takeDamage(1);
                    }
                    scene.removeGameObject(this.gameObject);
                }
            }
        }
        
        // Initialize game when page loads
        window.addEventListener('load', () => {
            console.log('Platformer Adventure loading...');
            setTimeout(initGame, 100);
        });
    </script>
</body>
</html>