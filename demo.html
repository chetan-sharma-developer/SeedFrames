<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SeedFrames Engine - Advanced Features Demo</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: #ffffff;
        }
        
        .demo-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .feature-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #2a2a2a;
            border-radius: 8px;
        }
        
        .feature-title {
            color: #4a90e2;
            margin-bottom: 15px;
        }
        
        .controls {
            margin: 20px 0;
            padding: 15px;
            background: #333;
            border-radius: 5px;
        }
        
        .control-group {
            margin: 10px 0;
        }
        
        button {
            background: #4a90e2;
            color: white;
            border: none;
            padding: 8px 16px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        button:hover {
            background: #357abd;
        }
        
        button:active {
            background: #2c5aa0;
        }
        
        .game-container {
            border: 2px solid #4a90e2;
            border-radius: 8px;
            margin: 20px 0;
            display: inline-block;
        }
        
        .info-panel {
            background: #333;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .code-example {
            background: #1e1e1e;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <h1>üéÆ SeedFrames Engine - Advanced Features Demo</h1>
        
        <div class="feature-section">
            <h2 class="feature-title">üöÄ Engine Initialization</h2>
            <div class="controls">
                <button onclick="initEngine()">Initialize Engine</button>
                <button onclick="startDemo()">Start Demo</button>
                <button onclick="stopDemo()">Stop Demo</button>
            </div>
            <div class="info-panel">
                <strong>Status:</strong> <span id="engine-status">Not initialized</span>
            </div>
        </div>
        
        <div class="game-container" id="game-container"></div>
        
        <div class="feature-section">
            <h2 class="feature-title">üé≠ Animation System</h2>
            <div class="controls">
                <button onclick="playIdleAnimation()">Play Idle</button>
                <button onclick="playRunAnimation()">Play Run</button>
                <button onclick="playJumpAnimation()">Play Jump</button>
                <button onclick="toggleSkeletalAnimation()">Toggle Skeletal</button>
            </div>
            <div class="code-example">
// Create animated sprite with multiple animations
const player = scene.createGameObject('AnimatedPlayer')
    .at(400, 300)
    .withSpriteRenderer('player.png', 64, 64)
    .build();

const spriteRenderer = player.getComponent(SpriteRenderer);

// Add frame-based animations
spriteRenderer.addAnimation('idle', [
    { image: idleFrame1, x: 0, y: 0, width: 64, height: 64 },
    { image: idleFrame2, x: 64, y: 0, width: 64, height: 64 }
], 0.3, true);

spriteRenderer.addAnimation('run', [
    { image: runFrame1, x: 0, y: 64, width: 64, height: 64 },
    { image: runFrame2, x: 64, y: 64, width: 64, height: 64 }
], 0.15, true);

// Play animation
spriteRenderer.playAnimation('idle');
            </div>
        </div>
        
        <div class="feature-section">
            <h2 class="feature-title">üå≥ Spatial Partitioning (Quadtree)</h2>
            <div class="controls">
                <button onclick="toggleQuadtree()">Toggle Quadtree Visualization</button>
                <button onclick="addManyObjects()">Add 100 Objects</button>
                <button onclick="clearObjects()">Clear Objects</button>
            </div>
            <div class="info-panel">
                <strong>Performance:</strong> <span id="performance-info">No data</span>
            </div>
            <div class="code-example">
// Configure quadtree for optimal collision detection
engine.physicsEngine.setQuadtreeBounds(0, 0, 2000, 2000);
engine.physicsEngine.setQuadtreeSettings(10, 8);

// Objects are automatically inserted into quadtree
// Collision detection is now O(log n) instead of O(n¬≤)
            </div>
        </div>
        
        <div class="feature-section">
            <h2 class="feature-title">üì± Touch & Gamepad Input</h2>
            <div class="controls">
                <button onclick="enableTouchControls()">Enable Touch</button>
                <button onclick="testGamepad()">Test Gamepad</button>
                <button onclick="showInputInfo()">Show Input Info</button>
            </div>
            <div class="info-panel">
                <strong>Touch Support:</strong> <span id="touch-info">Not enabled</span><br>
                <strong>Gamepad:</strong> <span id="gamepad-info">Not connected</span>
            </div>
            <div class="code-example">
// Touch input handling
if (inputManager.isTouchActive(0)) {
    const touchPos = inputManager.getTouchPosition(0);
    const joystickVector = inputManager.getVirtualJoystickVector();
    
    // Move player based on joystick input
    player.transform.position.add(joystickVector.multiplyByScalar(5));
}

// Gamepad input
if (inputManager.isGamepadConnected()) {
    const leftStickX = inputManager.getGamepadAxis(0, 0);
    const leftStickY = inputManager.getGamepadAxis(0, 1);
    
    if (inputManager.isGamepadButtonPressed(0, 0)) {
        // A button pressed
        player.jump();
    }
}
            </div>
        </div>
        
        <div class="feature-section">
            <h2 class="feature-title">üé® UI System</h2>
            <div class="controls">
                <button onclick="createUI()">Create UI Elements</button>
                <button onclick="toggleUI()">Toggle UI</button>
                <button onclick="updateUIText()">Update Text</button>
            </div>
            <div class="code-example">
// Create UI system
const uiSystem = new UISystem();

// Add button
const button = new UIButton(50, 50, 120, 40, "Click Me!");
button.onClick = () => {
    console.log("Button clicked!");
    createExplosion();
};

// Add text
const text = new UIText(50, 100, "Score: 0", 18);
text.color = "#ffff00";

// Add slider
const slider = new UISlider(50, 150, 200, 20, 0, 100, 50);
slider.onValueChange = (value) => {
    console.log("Slider value:", value);
};

uiSystem.addElement(button);
uiSystem.addElement(text);
uiSystem.addElement(slider);
            </div>
        </div>
        
        <div class="feature-section">
            <h2 class="feature-title">‚ú® Particle System</h2>
            <div class="controls">
                <button onclick="createExplosion()">Create Explosion</button>
                <button onclick="createSmoke()">Create Smoke</button>
                <button onclick="createMagic()">Create Magic</button>
                <button onclick="toggleParticles()">Toggle Particles</button>
            </div>
            <div class="code-example">
// Create particle emitter
const emitter = new ParticleEmitter();
emitter.setExplosionConfig(); // Use preset configuration
emitter.emissionRate = 50;
emitter.maxParticles = 100;

// Add to game object
const explosion = scene.createGameObject('Explosion')
    .at(400, 300)
    .build();
explosion.addComponent(emitter);

// Emit burst of particles
emitter.emitBurst(50);
            </div>
        </div>
        
        <div class="feature-section">
            <h2 class="feature-title">üîä Enhanced Audio System</h2>
            <div class="controls">
                <button onclick="playSpatialAudio()">Play Spatial Audio</button>
                <button onclick="testFadeEffects()">Test Fade Effects</button>
                <button onclick="changePitch()">Change Pitch</button>
            </div>
            <div class="code-example">
// Create spatial audio source
const audioSource = new AudioSource('explosion.wav');
audioSource.setSpatial(true, 500, 1.0);
audioSource.setListener(camera); // Camera as listener

// Advanced audio controls
audioSource.fadeIn(2.0); // Fade in over 2 seconds
audioSource.setPitch(1.5); // Increase pitch
audioSource.setPan(-0.5); // Pan to left

audioSource.play();
            </div>
        </div>
        
        <div class="feature-section">
            <h2 class="feature-title">üíæ Scene Serialization</h2>
            <div class="controls">
                <button onclick="saveScene()">Save Scene</button>
                <button onclick="loadScene()">Load Scene</button>
                <button onclick="exportScene()">Export Scene</button>
            </div>
            <div class="code-example">
// Save scene to localStorage
engine.sceneManager.saveSceneToStorage('main', 'saved_game');

// Load scene from localStorage
const loadedScene = engine.sceneManager.loadSceneFromStorage('saved_game');

// Export scene to file
engine.sceneManager.exportSceneToFile('main', 'my_level.json');
            </div>
        </div>
        
        <div class="feature-section">
            <h2 class="feature-title">üêõ Debug Overlay</h2>
            <div class="controls">
                <button onclick="toggleDebugOverlay()">Toggle Debug Overlay</button>
                <button onclick="toggleFPS()">Toggle FPS</button>
                <button onclick="toggleProfiler()">Toggle Profiler</button>
                <button onclick="resetStats()">Reset Stats</button>
            </div>
            <div class="code-example">
// Enable debug mode
Debug.enabled = true;

// Toggle debug overlay
Debug.toggleOverlay();

// Profile specific operations
Debug.startProfile('collision_detection');
// ... collision detection code ...
Debug.endProfile('collision_detection');

// Show quadtree visualization
Debug.toggleQuadtree();
            </div>
        </div>
        
        <div class="feature-section">
            <h2 class="feature-title">üìä Performance Monitoring</h2>
            <div class="info-panel">
                <strong>FPS:</strong> <span id="fps-display">--</span><br>
                <strong>Frame Time:</strong> <span id="frame-time">--</span><br>
                <strong>Active Objects:</strong> <span id="object-count">--</span><br>
                <strong>Memory Usage:</strong> <span id="memory-usage">--</span>
            </div>
        </div>
    </div>

    <script src="./seedframes.js"></script>
    <script>
        let engine = null;
        let scene = null;
        let player = null;
        let uiSystem = null;
        let demoRunning = false;
        let animationTimer = 0;
        
        function initEngine() {
            try {
                engine = new GameEngine.SeedFrames({
                    width: 800,
                    height: 600,
                    containerId: 'game-container',
                    backgroundColor: '#87CEEB',
                    debug: true
                });
                
                scene = engine.createScene('DemoScene');
                engine.sceneManager.add('demo', scene);
                
                // Create player
                player = scene.createGameObject('Player')
                    .at(400, 300)
                    .withColor('#4a90e2', 32, 48)
                    .withCollider('box', 32, 48, false, 'Player')
                    .build();
                
                // Create some platforms
                for (let i = 0; i < 5; i++) {
                    scene.createGameObject(`Platform${i}`)
                        .at(200 + i * 150, 500)
                        .withColor('#8B4513', 100, 20)
                        .withCollider('box', 100, 20, false, 'Platform')
                        .build();
                }
                
                // Setup physics
                engine.physicsEngine.setCollisionRule('Player', 'Platform', true);
                
                // Setup camera
                scene.camera.follow(player);
                
                document.getElementById('engine-status').textContent = 'Initialized';
                console.log('Engine initialized successfully!');
                
            } catch (error) {
                console.error('Failed to initialize engine:', error);
                document.getElementById('engine-status').textContent = 'Failed: ' + error.message;
            }
        }
        
        function startDemo() {
            if (!engine) {
                alert('Please initialize the engine first!');
                return;
            }
            
            engine.start();
            demoRunning = true;
            document.getElementById('engine-status').textContent = 'Running';
            
            // Start demo loop
            demoLoop();
        }
        
        function stopDemo() {
            if (engine && engine.gameLoop) {
                engine.gameLoop.stop();
                demoRunning = false;
                document.getElementById('engine-status').textContent = 'Stopped';
            }
        }
        
        function demoLoop() {
            if (!demoRunning) return;
            
            // Update demo logic
            animationTimer += 0.016; // ~60 FPS
            
            // Animate player
            if (player) {
                player.transform.position.x = 400 + Math.sin(animationTimer) * 100;
            }
            
            // Update performance display
            updatePerformanceDisplay();
            
            requestAnimationFrame(demoLoop);
        }
        
        function updatePerformanceDisplay() {
            if (!engine) return;
            
            const fps = engine.gameLoop ? engine.gameLoop.getFPS() : 0;
            document.getElementById('fps-display').textContent = fps;
            
            // Update other stats
            if (scene) {
                document.getElementById('object-count').textContent = scene.gameObjects.length;
            }
        }
        
        function playIdleAnimation() {
            if (!player) return;
            console.log('Playing idle animation');
        }
        
        function playRunAnimation() {
            if (!player) return;
            console.log('Playing run animation');
        }
        
        function playJumpAnimation() {
            if (!player) return;
            console.log('Playing jump animation');
        }
        
        function toggleSkeletalAnimation() {
            if (!player) return;
            console.log('Toggling skeletal animation');
        }
        
        function toggleQuadtree() {
            if (!engine) return;
            GameEngine.Debug.toggleQuadtree();
            console.log('Quadtree visualization toggled');
        }
        
        function addManyObjects() {
            if (!scene) return;
            
            for (let i = 0; i < 100; i++) {
                scene.createGameObject(`Object${i}`)
                    .at(Math.random() * 800, Math.random() * 600)
                    .withColor(`hsl(${Math.random() * 360}, 70%, 50%)`, 10, 10)
                    .withCollider('box', 10, 10, false, 'Object')
                    .build();
            }
            
            console.log('Added 100 objects');
        }
        
        function clearObjects() {
            if (!scene) return;
            
            // Remove all objects except player and platforms
            const objectsToRemove = scene.gameObjects.filter(obj => 
                !obj.name.includes('Player') && !obj.name.includes('Platform')
            );
            
            objectsToRemove.forEach(obj => scene.removeGameObject(obj));
            console.log('Cleared objects');
        }
        
        function enableTouchControls() {
            if (!engine) return;
            
            // Touch controls are automatically enabled when canvas is set
            document.getElementById('touch-info').textContent = 'Enabled';
            console.log('Touch controls enabled');
        }
        
        function testGamepad() {
            if (!engine) return;
            
            const connected = engine.inputManager.isGamepadConnected();
            document.getElementById('gamepad-info').textContent = connected ? 'Connected' : 'Not connected';
            console.log('Gamepad test:', connected ? 'Connected' : 'Not connected');
        }
        
        function showInputInfo() {
            if (!engine) return;
            
            const touchCount = engine.inputManager.getTouchCount();
            const gamepadCount = engine.inputManager.getGamepadCount();
            
            console.log(`Touch count: ${touchCount}, Gamepad count: ${gamepadCount}`);
        }
        
        function createUI() {
            if (!scene) return;
            
            uiSystem = new GameEngine.UISystem();
            
            // Create button
            const button = new GameEngine.UIButton(50, 50, 120, 40, "Click Me!");
            button.onClick = () => {
                console.log("Button clicked!");
                createExplosion();
            };
            
            // Create text
            const text = new GameEngine.UIText(50, 100, "Score: 0", 18);
            text.color = "#ffff00";
            
            // Create slider
            const slider = new GameEngine.UISlider(50, 150, 200, 20, 0, 100, 50);
            slider.onValueChange = (value) => {
                console.log("Slider value:", value);
            };
            
            uiSystem.addElement(button);
            uiSystem.addElement(text);
            uiSystem.addElement(slider);
            
            console.log('UI created');
        }
        
        function toggleUI() {
            if (!uiSystem) return;
            
            uiSystem.elements.forEach(element => {
                element.visible = !element.visible;
            });
            
            console.log('UI toggled');
        }
        
        function updateUIText() {
            if (!uiSystem) return;
            
            const textElement = uiSystem.elements.find(el => el instanceof GameEngine.UIText);
            if (textElement) {
                textElement.setText(`Score: ${Math.floor(Math.random() * 1000)}`);
            }
        }
        
        function createExplosion() {
            if (!scene) return;
            
            const emitter = new GameEngine.ParticleEmitter();
            emitter.setExplosionConfig();
            emitter.emissionRate = 50;
            emitter.maxParticles = 100;
            
            const explosion = scene.createGameObject('Explosion')
                .at(400, 300)
                .build();
            explosion.addComponent(emitter);
            
            emitter.emitBurst(50);
            console.log('Explosion created');
        }
        
        function createSmoke() {
            if (!scene) return;
            
            const emitter = new GameEngine.ParticleEmitter();
            emitter.setSmokeConfig();
            
            const smoke = scene.createGameObject('Smoke')
                .at(400, 300)
                .build();
            smoke.addComponent(emitter);
            
            console.log('Smoke created');
        }
        
        function createMagic() {
            if (!scene) return;
            
            const emitter = new GameEngine.ParticleEmitter();
            emitter.setMagicConfig();
            
            const magic = scene.createGameObject('Magic')
                .at(400, 300)
                .build();
            magic.addComponent(emitter);
            
            console.log('Magic created');
        }
        
        function toggleParticles() {
            if (!scene) return;
            
            const emitters = scene.findGameObjectsWithComponent(GameEngine.ParticleEmitter);
            emitters.forEach(emitter => {
                emitter.active = !emitter.active;
            });
            
            console.log('Particles toggled');
        }
        
        function playSpatialAudio() {
            if (!scene) return;
            
            const audioSource = new GameEngine.AudioSource();
            audioSource.setSpatial(true, 500, 1.0);
            audioSource.setListener(scene.camera);
            
            // Create a temporary audio object for demo
            const audio = new Audio();
            audio.src = 'data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAA=';
            audioSource.audio = audio;
            
            audioSource.play();
            console.log('Spatial audio played');
        }
        
        function testFadeEffects() {
            if (!scene) return;
            
            const audioSource = new GameEngine.AudioSource();
            audioSource.fadeIn(2.0);
            
            const audio = new Audio();
            audio.src = 'data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAA=';
            audioSource.audio = audio;
            
            audioSource.play();
            console.log('Fade effects tested');
        }
        
        function changePitch() {
            if (!scene) return;
            
            const audioSource = new GameEngine.AudioSource();
            audioSource.setPitch(1.5);
            
            console.log('Pitch changed to 1.5');
        }
        
        function saveScene() {
            if (!engine) return;
            
            const success = engine.sceneManager.saveSceneToStorage('demo', 'demo_save');
            if (success) {
                console.log('Scene saved successfully');
                alert('Scene saved to localStorage!');
            } else {
                console.error('Failed to save scene');
                alert('Failed to save scene');
            }
        }
        
        function loadScene() {
            if (!engine) return;
            
            const loadedScene = engine.sceneManager.loadSceneFromStorage('demo_save');
            if (loadedScene) {
                console.log('Scene loaded successfully');
                alert('Scene loaded from localStorage!');
            } else {
                console.error('Failed to load scene');
                alert('Failed to load scene');
            }
        }
        
        function exportScene() {
            if (!engine) return;
            
            const success = engine.sceneManager.exportSceneToFile('demo', 'demo_scene.json');
            if (success) {
                console.log('Scene exported successfully');
                alert('Scene exported to file!');
            } else {
                console.error('Failed to export scene');
                alert('Failed to export scene');
            }
        }
        
        function toggleDebugOverlay() {
            GameEngine.Debug.toggleOverlay();
            console.log('Debug overlay toggled');
        }
        
        function toggleFPS() {
            GameEngine.Debug.toggleFPS();
            console.log('FPS display toggled');
        }
        
        function toggleProfiler() {
            GameEngine.Debug.toggleProfiler();
            console.log('Profiler toggled');
        }
        
        function resetStats() {
            GameEngine.Debug.resetStats();
            console.log('Stats reset');
        }
        
        // Initialize when page loads
        window.addEventListener('load', () => {
            console.log('Demo page loaded. Click "Initialize Engine" to start.');
        });
    </script>
</body>
</html>