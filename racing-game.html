<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Racing Game - SeedFrames Engine</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        #game-container {
            border: 3px solid #333;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            background: #000;
        }
        h1 {
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 20px;
        }
        .controls {
            color: white;
            background: rgba(0,0,0,0.7);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            text-align: center;
        }
        .ui-overlay {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }
    </style>
</head>
<body>
    <h1>üèéÔ∏è Racing Game</h1>
    <div id="game-container"></div>
    <div class="controls">
        <p><strong>Controls:</strong> WASD or Arrow Keys to drive, Space for boost</p>
        <p><strong>Goal:</strong> Race against AI cars and avoid obstacles!</p>
    </div>

    <script src="src/seedframes.js"></script>
    <script>
        // Wait for engine to load
        function checkEngine() {
            if (typeof GameEngine !== 'undefined' && GameEngine.SeedFrames) {
                initGame();
            } else {
                setTimeout(checkEngine, 100);
            }
        }

        async function initGame() {
            const engine = new GameEngine.SeedFrames({
                width: 800,
                height: 600,
                containerId: 'game-container',
                backgroundColor: '#228B22',
                debug: true
            });

            // Register SVG assets
            await engine.assetManagement({
                assets: {
                    player_car: GameEngine.SVG(`
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="24" viewBox="0 0 48 24">
                            <!-- Car body -->
                            <rect x="4" y="8" width="40" height="8" fill="#FF4444" rx="2"/>
                            <!-- Car top -->
                            <rect x="12" y="4" width="24" height="6" fill="#CC3333" rx="1"/>
                            <!-- Wheels -->
                            <circle cx="12" cy="20" r="4" fill="#333333"/>
                            <circle cx="36" cy="20" r="4" fill="#333333"/>
                            <!-- Headlights -->
                            <circle cx="6" cy="10" r="1" fill="#FFFF00"/>
                            <circle cx="42" cy="10" r="1" fill="#FFFF00"/>
                            <!-- Windows -->
                            <rect x="14" y="5" width="20" height="4" fill="#87CEEB" opacity="0.8"/>
                        </svg>
                    `),
                    ai_car: GameEngine.SVG(`
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="24" viewBox="0 0 48 24">
                            <!-- Car body -->
                            <rect x="4" y="8" width="40" height="8" fill="#4444FF" rx="2"/>
                            <!-- Car top -->
                            <rect x="12" y="4" width="24" height="6" fill="#3333CC" rx="1"/>
                            <!-- Wheels -->
                            <circle cx="12" cy="20" r="4" fill="#333333"/>
                            <circle cx="36" cy="20" r="4" fill="#333333"/>
                            <!-- Headlights -->
                            <circle cx="6" cy="10" r="1" fill="#FFFF00"/>
                            <circle cx="42" cy="10" r="1" fill="#FFFF00"/>
                            <!-- Windows -->
                            <rect x="14" y="5" width="20" height="4" fill="#87CEEB" opacity="0.8"/>
                        </svg>
                    `),
                    obstacle: GameEngine.SVG(`
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
                            <rect x="4" y="4" width="24" height="24" fill="#8B4513" stroke="#654321" stroke-width="2"/>
                            <rect x="8" y="8" width="16" height="16" fill="#A0522D"/>
                            <rect x="12" y="12" width="8" height="8" fill="#CD853F"/>
                        </svg>
                    `),
                    road: GameEngine.SVG(`
                        <svg xmlns="http://www.w3.org/2000/svg" width="800" height="600" viewBox="0 0 800 600">
                            <!-- Road background -->
                            <rect width="800" height="600" fill="#696969"/>
                            <!-- Road markings -->
                            <rect x="0" y="0" width="800" height="600" fill="none" stroke="#FFFFFF" stroke-width="4" stroke-dasharray="50,50"/>
                            <!-- Side lines -->
                            <rect x="0" y="0" width="800" height="8" fill="#FFFFFF"/>
                            <rect x="0" y="592" width="800" height="8" fill="#FFFFFF"/>
                        </svg>
                    `),
                    boost_particle: GameEngine.SVG(`
                        <svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 8 8">
                            <circle cx="4" cy="4" r="3" fill="#FF6600"/>
                            <circle cx="4" cy="4" r="1" fill="#FFFF00"/>
                        </svg>
                    `)
                }
            });

            const scene = new GameEngine.Scene('main');
            engine.sceneManager.add('main', scene);

            // Create player car
            const player = scene.createGameObject('Player')
                .at(200, 500)
                .asset('player_car', 48, 24)
                .withCollider('box', 48, 24, false, 'Player')
                .withRacingPlayer({
                    maxSpeed: 300,
                    acceleration: 200,
                    deceleration: 150,
                    turnSpeed: 180,
                    onDrift: () => console.log('Player drifting!')
                })
                .build();

            // Create AI cars
            const aiCars = [
                { x: 150, y: 400, speed: 120 },
                { x: 300, y: 300, speed: 140 },
                { x: 450, y: 200, speed: 160 }
            ];

            aiCars.forEach((aiData, index) => {
                const aiCar = scene.createGameObject(`AI_Car_${index}`)
                    .at(aiData.x, aiData.y)
                    .asset('ai_car', 48, 24)
                    .withCollider('box', 48, 24, false, 'AI')
                    .withComponent(new AIDrivingComponent(aiData.speed))
                    .build();
            });

            // Create obstacles
            const obstacles = [
                { x: 100, y: 150 },
                { x: 400, y: 100 },
                { x: 600, y: 250 },
                { x: 200, y: 350 }
            ];

            obstacles.forEach((obstacle, index) => {
                scene.createGameObject(`Obstacle_${index}`)
                    .at(obstacle.x, obstacle.y)
                    .asset('obstacle', 32, 32)
                    .withCollider('box', 32, 32, false, 'Obstacle')
                    .build();
            });

            // Create road background
            scene.createGameObject('Road')
                .at(400, 300)
                .asset('road', 800, 600)
                .build();

            // Add particle system for boost effects
            const particleSystem = scene.createGameObject('ParticleSystem')
                .at(0, 0)
                .withComponent(new GameEngine.ParticleEmitter())
                .build();

            const emitter = particleSystem.getComponent(GameEngine.ParticleEmitter);
            emitter.setSmokeConfig();

            // Add UI
            const uiSystem = new GameEngine.UISystem();
            scene.addGameObject(uiSystem);

            const speedText = new GameEngine.UIText('Speed: 0 km/h', 20, 20, '#FFFFFF', '20px Arial');
            uiSystem.addElement(speedText);

            const boostText = new GameEngine.UIText('Boost: Ready', 20, 50, '#FFFFFF', '20px Arial');
            uiSystem.addElement(boostText);

            // Game state
            let boostAvailable = true;
            let boostCooldown = 0;

            // Input handling
            const keys = {};
            document.addEventListener('keydown', (e) => {
                keys[e.code] = true;
                
                if (e.code === 'Space' && boostAvailable) {
                    const racingComponent = player.getComponent(GameEngine.RacingPlayer);
                    if (racingComponent) {
                        racingComponent.setBoost(2.0, 1.0);
                        boostAvailable = false;
                        boostCooldown = 3.0;
                        boostText.text = 'Boost: Cooldown';
                    }
                }
            });

            document.addEventListener('keyup', (e) => {
                keys[e.code] = false;
            });

            // Game loop update
            const gameLoop = (deltaTime) => {
                const racingComponent = player.getComponent(GameEngine.RacingPlayer);
                if (racingComponent) {
                    // Handle input
                    if (keys['KeyW'] || keys['ArrowUp']) {
                        racingComponent.accelerate(1.0);
                    }
                    if (keys['KeyS'] || keys['ArrowDown']) {
                        racingComponent.brake(1.0);
                    }
                    if (keys['KeyA'] || keys['ArrowLeft']) {
                        racingComponent.steer(-1.0);
                    }
                    if (keys['KeyD'] || keys['ArrowRight']) {
                        racingComponent.steer(1.0);
                    }

                    // Update boost cooldown
                    if (!boostAvailable) {
                        boostCooldown -= deltaTime;
                        if (boostCooldown <= 0) {
                            boostAvailable = true;
                            boostText.text = 'Boost: Ready';
                        }
                    }

                    // Update UI
                    const speedKmh = Math.round(racingComponent.getSpeedKmh());
                    speedText.text = `Speed: ${speedKmh} km/h`;

                    // Update components
                    racingComponent.update(deltaTime);
                }

                // Update AI cars
                scene.findGameObjectsByName('AI_Car').forEach(aiCar => {
                    const aiComponent = aiCar.getComponent(AIDrivingComponent);
                    if (aiComponent) {
                        aiComponent.update(deltaTime);
                    }
                });
            };

            // Add game loop to scene
            scene.update = gameLoop;

            // Load the scene
            engine.sceneManager.load('main');
            
            // Start the engine
            engine.start();
        }

        // AI Driving Component
        class AIDrivingComponent extends GameEngine.Component {
            constructor(targetSpeed = 100) {
                super();
                this.targetSpeed = targetSpeed;
                this.currentSpeed = 0;
                this.direction = new GameEngine.Vector2(0, -1); // Drive upward
            }

            update(deltaTime) {
                if (!this.gameObject) return;

                // Simple AI: drive upward at target speed
                const moveSpeed = this.targetSpeed * deltaTime;
                this.gameObject.transform.position.x += this.direction.x * moveSpeed;
                this.gameObject.transform.position.y += this.direction.y * moveSpeed;

                // Wrap around screen
                if (this.gameObject.transform.position.y < -50) {
                    this.gameObject.transform.position.y = 650;
                    this.gameObject.transform.position.x = Math.random() * 700 + 50;
                }
            }
        }

        // Start checking for engine
        checkEngine();
    </script>
</body>
</html>