<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Top-Down Shooter - SeedFrames Engine</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        #game-container {
            border: 3px solid #333;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            background: #000;
        }
        h1 {
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 20px;
        }
        .controls {
            color: white;
            background: rgba(0,0,0,0.7);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>ðŸŽ¯ Top-Down Shooter</h1>
    <div id="game-container"></div>
    <div class="controls">
        <p><strong>Controls:</strong> WASD to move, Mouse to aim, Click to shoot</p>
        <p><strong>Goal:</strong> Defeat all enemies and survive as long as possible!</p>
    </div>

    <script src="src/seedframes.js"></script>
    <script>
        // Wait for engine to load
        function checkEngine() {
            if (typeof GameEngine !== 'undefined' && GameEngine.SeedFrames) {
                initGame();
            } else {
                setTimeout(checkEngine, 100);
            }
        }

        async function initGame() {
            const engine = new GameEngine.SeedFrames({
                width: 800,
                height: 600,
                containerId: 'game-container',
                backgroundColor: '#2F4F4F',
                debug: true
            });

            // Register SVG assets
            await engine.assetManagement({
                assets: {
                    player: GameEngine.SVG(`
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
                            <!-- Player body -->
                            <circle cx="16" cy="16" r="12" fill="#4A90E2"/>
                            <!-- Player details -->
                            <circle cx="16" cy="16" r="8" fill="#2E5C8A"/>
                            <!-- Gun barrel -->
                            <rect x="24" y="14" width="8" height="4" fill="#333333"/>
                            <!-- Eyes -->
                            <circle cx="14" cy="12" r="2" fill="#FFFFFF"/>
                            <circle cx="18" cy="12" r="2" fill="#FFFFFF"/>
                            <circle cx="14" cy="12" r="1" fill="#000000"/>
                            <circle cx="18" cy="12" r="1" fill="#000000"/>
                        </svg>
                    `),
                    enemy: GameEngine.SVG(`
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                            <!-- Enemy body -->
                            <circle cx="12" cy="12" r="10" fill="#FF4444"/>
                            <!-- Enemy details -->
                            <circle cx="12" cy="12" r="6" fill="#CC3333"/>
                            <!-- Spikes -->
                            <polygon points="12,2 14,8 20,8 15,12 17,18 12,14 7,18 9,12 4,8 10,8" fill="#AA2222"/>
                            <!-- Eyes -->
                            <circle cx="9" cy="9" r="2" fill="#FFFFFF"/>
                            <circle cx="15" cy="9" r="2" fill="#FFFFFF"/>
                            <circle cx="9" cy="9" r="1" fill="#000000"/>
                            <circle cx="15" cy="9" r="1" fill="#000000"/>
                        </svg>
                    `),
                    bullet: GameEngine.SVG(`
                        <svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 8 8">
                            <circle cx="4" cy="4" r="3" fill="#FFFF00"/>
                            <circle cx="4" cy="4" r="1" fill="#FFFFFF"/>
                        </svg>
                    `),
                    powerup: GameEngine.SVG(`
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20">
                            <polygon points="10,2 12,8 18,8 13,12 15,18 10,14 5,18 7,12 2,8 8,8" fill="#FFD700"/>
                            <polygon points="10,4 11,8 15,8 12,11 13,15 10,12 7,15 8,11 5,8 9,8" fill="#FFA500"/>
                        </svg>
                    `),
                    explosion: GameEngine.SVG(`
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
                            <circle cx="16" cy="16" r="14" fill="#FF6600"/>
                            <circle cx="16" cy="16" r="10" fill="#FF8800"/>
                            <circle cx="16" cy="16" r="6" fill="#FFAA00"/>
                            <circle cx="16" cy="16" r="2" fill="#FFFF00"/>
                        </svg>
                    `),
                    background: GameEngine.SVG(`
                        <svg xmlns="http://www.w3.org/2000/svg" width="800" height="600" viewBox="0 0 800 600">
                            <defs>
                                <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
                                    <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#3F5F5F" stroke-width="1"/>
                                </pattern>
                            </defs>
                            <rect width="800" height="600" fill="#2F4F4F"/>
                            <rect width="800" height="600" fill="url(#grid)"/>
                        </svg>
                    `)
                }
            });

            const scene = new GameEngine.Scene('main');
            engine.sceneManager.add('main', scene);

            // Create player
            const player = scene.createGameObject('Player')
                .at(400, 300)
                .asset('player', 32, 32)
                .withCollider('circle', 32, 32, false, 'Player')
                .withTopDownPlayer({
                    speed: 150,
                    onMove: () => console.log('Player moving!')
                })
                .build();

            // Create background
            scene.createGameObject('Background')
                .at(400, 300)
                .asset('background', 800, 600)
                .build();

            // Game state
            let score = 0;
            let enemies = [];
            let bullets = [];
            let powerups = [];
            let wave = 1;
            let enemiesPerWave = 5;

            // Add UI
            const uiSystem = new GameEngine.UISystem();
            scene.addGameObject(uiSystem);

            const scoreText = new GameEngine.UIText('Score: 0', 20, 20, '#FFFFFF', '20px Arial');
            uiSystem.addElement(scoreText);

            const waveText = new GameEngine.UIText('Wave: 1', 20, 50, '#FFFFFF', '20px Arial');
            uiSystem.addElement(waveText);

            const enemiesText = new GameEngine.UIText('Enemies: 0', 20, 80, '#FFFFFF', '20px Arial');
            uiSystem.addElement(enemiesText);

            // Mouse tracking
            let mouseX = 400;
            let mouseY = 300;
            const canvas = document.getElementById('game-container').querySelector('canvas');
            
            canvas.addEventListener('mousemove', (e) => {
                const rect = canvas.getBoundingClientRect();
                mouseX = e.clientX - rect.left;
                mouseY = e.clientY - rect.top;
            });

            canvas.addEventListener('click', () => {
                shootBullet();
            });

            // Shooting function
            function shootBullet() {
                const direction = new GameEngine.Vector2(mouseX - player.transform.position.x, mouseY - player.transform.position.y).normalize();
                const bulletSpeed = 400;
                
                const bullet = scene.createGameObject('Bullet')
                    .at(player.transform.position.x, player.transform.position.y)
                    .asset('bullet', 8, 8)
                    .withCollider('circle', 8, 8, false, 'Bullet')
                    .build();

                // Add bullet behavior
                bullet.velocity = direction.multiplyByScalar(bulletSpeed);
                bullet.lifetime = 3.0;
                bullet.timer = 0;

                bullet.update = (deltaTime) => {
                    bullet.transform.position.x += bullet.velocity.x * deltaTime;
                    bullet.transform.position.y += bullet.velocity.y * deltaTime;
                    
                    bullet.timer += deltaTime;
                    if (bullet.timer >= bullet.lifetime) {
                        bullet.destroy();
                    }

                    // Wrap around screen
                    if (bullet.transform.position.x < -10) bullet.transform.position.x = 810;
                    if (bullet.transform.position.x > 810) bullet.transform.position.x = -10;
                    if (bullet.transform.position.y < -10) bullet.transform.position.y = 610;
                    if (bullet.transform.position.y > 610) bullet.transform.position.y = -10;
                };

                bullets.push(bullet);
            }

            // Enemy spawning
            function spawnEnemy() {
                const side = Math.floor(Math.random() * 4); // 0: top, 1: right, 2: bottom, 3: left
                let x, y;
                
                switch(side) {
                    case 0: // top
                        x = Math.random() * 800;
                        y = -30;
                        break;
                    case 1: // right
                        x = 830;
                        y = Math.random() * 600;
                        break;
                    case 2: // bottom
                        x = Math.random() * 800;
                        y = 630;
                        break;
                    case 3: // left
                        x = -30;
                        y = Math.random() * 600;
                        break;
                }

                const enemy = scene.createGameObject('Enemy')
                    .at(x, y)
                    .asset('enemy', 24, 24)
                    .withCollider('circle', 24, 24, false, 'Enemy')
                    .build();

                // Add enemy AI
                enemy.speed = 50 + Math.random() * 50;
                enemy.update = (deltaTime) => {
                    const direction = new GameEngine.Vector2(
                        player.transform.position.x - enemy.transform.position.x,
                        player.transform.position.y - enemy.transform.position.y
                    ).normalize();
                    
                    enemy.transform.position.x += direction.x * enemy.speed * deltaTime;
                    enemy.transform.position.y += direction.y * enemy.speed * deltaTime;
                };

                // Enemy collision with player
                const collider = enemy.getComponent(GameEngine.Collider);
                collider.onCollisionEnter = (other) => {
                    if (other.getComponent(GameEngine.TopDownPlayer)) {
                        console.log('Player hit by enemy!');
                        enemy.destroy();
                        enemies = enemies.filter(e => e !== enemy);
                        // Reset player position
                        player.transform.position = new GameEngine.Vector2(400, 300);
                    }
                };

                enemies.push(enemy);
            }

            // Powerup spawning
            function spawnPowerup() {
                const x = Math.random() * 700 + 50;
                const y = Math.random() * 500 + 50;
                
                const powerup = scene.createGameObject('Powerup')
                    .at(x, y)
                    .asset('powerup', 20, 20)
                    .withCollider('circle', 20, 20, true, 'Powerup')
                    .build();

                // Add powerup behavior
                powerup.lifetime = 10.0;
                powerup.timer = 0;
                powerup.rotationSpeed = 90; // degrees per second

                powerup.update = (deltaTime) => {
                    powerup.transform.rotation += (powerup.rotationSpeed * Math.PI / 180) * deltaTime;
                    powerup.timer += deltaTime;
                    
                    if (powerup.timer >= powerup.lifetime) {
                        powerup.destroy();
                        powerups = powerups.filter(p => p !== powerup);
                    }
                };

                // Powerup collection
                const collider = powerup.getComponent(GameEngine.Collider);
                collider.onCollisionEnter = (other) => {
                    if (other.getComponent(GameEngine.TopDownPlayer)) {
                        console.log('Powerup collected!');
                        score += 100;
                        powerup.destroy();
                        powerups = powerups.filter(p => p !== powerup);
                    }
                };

                powerups.push(powerup);
            }

            // Spawn initial enemies
            for (let i = 0; i < enemiesPerWave; i++) {
                setTimeout(() => spawnEnemy(), i * 1000);
            }

            // Spawn powerups periodically
            setInterval(() => {
                if (powerups.length < 3) {
                    spawnPowerup();
                }
            }, 5000);

            // Game loop update
            scene.update = (deltaTime) => {
                // Update player rotation to face mouse
                const direction = new GameEngine.Vector2(mouseX - player.transform.position.x, mouseY - player.transform.position.y);
                player.transform.rotation = Math.atan2(direction.y, direction.x);

                // Update bullets
                bullets.forEach((bullet, index) => {
                    if (bullet && bullet.update) {
                        bullet.update(deltaTime);
                    }
                });

                // Update enemies
                enemies.forEach((enemy, index) => {
                    if (enemy && enemy.update) {
                        enemy.update(deltaTime);
                    }
                });

                // Update powerups
                powerups.forEach((powerup, index) => {
                    if (powerup && powerup.update) {
                        powerup.update(deltaTime);
                    }
                });

                // Check bullet-enemy collisions
                bullets.forEach((bullet, bulletIndex) => {
                    enemies.forEach((enemy, enemyIndex) => {
                        if (bullet && enemy) {
                            const bulletCollider = bullet.getComponent(GameEngine.Collider);
                            const enemyCollider = enemy.getComponent(GameEngine.Collider);
                            
                            if (bulletCollider && enemyCollider) {
                                const distance = bullet.transform.position.distance(enemy.transform.position);
                                if (distance < 20) {
                                    // Create explosion
                                    const explosion = scene.createGameObject('Explosion')
                                        .at(enemy.transform.position.x, enemy.transform.position.y)
                                        .asset('explosion', 32, 32)
                                        .build();
                                    
                                    explosion.lifetime = 0.5;
                                    explosion.timer = 0;
                                    explosion.update = (deltaTime) => {
                                        explosion.timer += deltaTime;
                                        explosion.transform.scale.x = 1 + explosion.timer * 2;
                                        explosion.transform.scale.y = 1 + explosion.timer * 2;
                                        explosion.alpha = 1 - explosion.timer / explosion.lifetime;
                                        
                                        if (explosion.timer >= explosion.lifetime) {
                                            explosion.destroy();
                                        }
                                    };

                                    // Destroy bullet and enemy
                                    bullet.destroy();
                                    enemy.destroy();
                                    bullets.splice(bulletIndex, 1);
                                    enemies.splice(enemyIndex, 1);
                                    
                                    score += 50;
                                }
                            }
                        }
                    });
                });

                // Check if wave is complete
                if (enemies.length === 0) {
                    wave++;
                    enemiesPerWave += 2;
                    for (let i = 0; i < enemiesPerWave; i++) {
                        setTimeout(() => spawnEnemy(), i * 800);
                    }
                }

                // Update UI
                scoreText.text = `Score: ${score}`;
                waveText.text = `Wave: ${wave}`;
                enemiesText.text = `Enemies: ${enemies.length}`;
            };

            // Load the scene
            engine.sceneManager.load('main');
            
            // Start the engine
            engine.start();
        }

        // Start checking for engine
        checkEngine();
    </script>
</body>
</html>